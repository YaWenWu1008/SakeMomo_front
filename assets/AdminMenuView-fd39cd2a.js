import{p as ie,aI as de,aJ as ce,g as ve,aK as me,D as fe,aL as ge,o as z,x as u,s as pe,I as Ve,A as xe,z as A,B as ye,u as be,aM as we,aN as Z,aO as he,c as t,aP as ke,H as j,Z as G,aQ as ee,aR as Ce,aS as Pe,aT as Fe,aU as Se,ac as Q,aV as Ie,v as Be,y as Me,M as Re,a6 as W,Q as ae,R as te,X as Ue,T as s,aW as Ae,af as Te,K as E,a0 as $,ah as X,aX as De,V as _e,S as Ne,_ as He,$ as r,ag as ze,al as Ee,ai as $e,a7 as Ge,ak as Ke,as as Oe,aY as qe,W as Le,a5 as je,a2 as Qe}from"./index-9af438fb.js";import{c as We,a as J,e as Xe,f as Je,u as Ye,d as T,V as Ze}from"./index.esm-b50caca9.js";import{V as ea,a as aa,b as le}from"./VRow-4da47f46.js";import{V as ta}from"./VCheckbox-7e8585f4.js";import"./_commonjsHelpers-725317a4.js";const la=ie({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...de(),...ce()},"VTextarea"),oa=ve()({name:"VTextarea",directives:{Intersect:me},inheritAttrs:!1,props:la(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,B){let{attrs:k,emit:C,slots:v}=B;const d=fe(e,"modelValue"),{isFocused:P,focus:M,blur:D}=ge(e),F=z(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),_=z(()=>{if(k.maxlength)return k.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function w(o,c){var i,p;!e.autofocus||!o||(p=(i=c[0].target)==null?void 0:i.focus)==null||p.call(i)}const N=u(),V=u(),y=pe(""),S=u(),H=z(()=>e.persistentPlaceholder||P.value||e.active);function I(){var o;S.value!==document.activeElement&&((o=S.value)==null||o.focus()),P.value||M()}function K(o){I(),C("click:control",o)}function O(o){C("mousedown:control",o)}function R(o){o.stopPropagation(),I(),Q(()=>{d.value="",Ie(e["onClick:clear"],o)})}function q(o){var i;const c=o.target;if(d.value=c.value,(i=e.modelModifiers)!=null&&i.trim){const p=[c.selectionStart,c.selectionEnd];Q(()=>{c.selectionStart=p[0],c.selectionEnd=p[1]})}}const f=u(),b=u(+e.rows),h=z(()=>["plain","underlined"].includes(e.variant));Ve(()=>{e.autoGrow||(b.value=+e.rows)});function g(){e.autoGrow&&Q(()=>{if(!f.value||!V.value)return;const o=getComputedStyle(f.value),c=getComputedStyle(V.value.$el),i=parseFloat(o.getPropertyValue("--v-field-padding-top"))+parseFloat(o.getPropertyValue("--v-input-padding-top"))+parseFloat(o.getPropertyValue("--v-field-padding-bottom")),p=f.value.scrollHeight,n=parseFloat(o.lineHeight),a=Math.max(parseFloat(e.rows)*n+i,parseFloat(c.getPropertyValue("--v-input-control-height"))),U=parseFloat(e.maxRows)*n+i||1/0,x=Me(p??0,a,U);b.value=Math.floor((x-i)/n),y.value=Be(x)})}xe(g),A(d,g),A(()=>e.rows,g),A(()=>e.maxRows,g),A(()=>e.density,g);let m;return A(f,o=>{o?(m=new ResizeObserver(g),m.observe(f.value)):m==null||m.disconnect()}),ye(()=>{m==null||m.disconnect()}),be(()=>{const o=!!(v.counter||e.counter||e.counterValue),c=!!(o||v.details),[i,p]=we(k),[{modelValue:n,...a}]=Z.filterProps(e),[U]=he(e);return t(Z,j({ref:N,modelValue:d.value,"onUpdate:modelValue":x=>d.value=x,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-text-field--plain-underlined":h.value},e.class],style:e.style},i,a,{centerAffix:b.value===1&&!h.value,focused:P.value}),{...v,default:x=>{let{isDisabled:l,isDirty:L,isReadonly:oe,isValid:ne}=x;return t(ke,j({ref:V,style:{"--v-textarea-control-height":y.value},onClick:K,onMousedown:O,"onClick:clear":R,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:"textbox"},U,{active:H.value||L.value,centerAffix:b.value===1&&!h.value,dirty:L.value||e.dirty,disabled:l.value,focused:P.value,error:ne.value===!1}),{...v,default:re=>{let{props:{class:Y,...se}}=re;return t(G,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),ee(t("textarea",j({ref:S,class:Y,value:d.value,onInput:q,autofocus:e.autofocus,readonly:oe.value,disabled:l.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:I,onBlur:D},se,p),null),[[Ce("intersect"),{handler:w},null,{once:!0}]]),e.autoGrow&&ee(t("textarea",{class:[Y,"v-textarea__sizer"],"onUpdate:modelValue":ue=>d.value=ue,ref:f,readonly:!0,"aria-hidden":"true"},null),[[Pe,d.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:c?x=>{var l;return t(G,null,[(l=v.details)==null?void 0:l.call(v,x),o&&t(G,null,[t("span",null,null),t(Fe,{active:e.persistentCounter||P.value,value:F.value,max:_.value},v.counter)])])}:void 0})}),Se({},N,V,S)}}),na=je("h1",{class:"text-center"},"菜單管理",-1),ca={__name:"AdminMenuView",setup(e){const B=Re(),k=u(5),C=u([{key:"name",order:"asc"}]),v=u(1),d=u([]),P=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"說明",align:"center",sortable:!1,key:"description"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],M=u(!1),D=u(0),F=u(""),_=()=>{v.value=1,w()},w=async()=>{M.value=!0;try{const{data:n}=await W.get("/products/all",{params:{page:v.value,itemsPerPage:k.value,sortBy:C.value[0].key,sortOrder:C.value[0].order,search:F.value}});d.value.splice(0,d.value.length,...n.result.data),D.value=n.result.count}catch(n){console.log(n),B({text:n.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}M.value=!1};w();const N=n=>{y.value=n._id,f.value.value=n.name,b.value.value=n.price,h.value.value=n.description,g.value.value=n.category,m.value.value=n.sell,V.value=!0},V=u(!1),y=u(""),S=()=>{y.value="",V.value=!0},H=()=>{V.value=!1,q(),i.value.deleteFileRecord()},I=["開胃小食","生食&沙拉","酒桃塔可","燒物","揚物","食事&吸物","甜點","夜場限定","酒"],K=We({name:J().required("缺少名稱"),price:Xe().typeError("缺少價格").required("缺少價格").min(0,"價格錯誤"),description:J().required("缺少說明"),category:J().required("缺少分類").test("isCategory",n=>I.includes(n)),sell:Je()}),{handleSubmit:O,isSubmitting:R,resetForm:q}=Ye({validationSchema:K,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),f=T("name"),b=T("price"),h=T("description"),g=T("category"),m=T("sell"),o=u([]),c=u([]),i=u(null),p=O(async n=>{if(!(y.value.length===0&&o.value.length===0))try{const a=new FormData;a.append("name",n.name),a.append("price",n.price),a.append("description",n.description),a.append("category",n.category),a.append("sell",n.sell),o.value.length>0&&a.append("image",o.value[0].file),y.value.length>0?await W.patch("/products/"+y.value,a):await W.post("/products",a),B({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),H(),w()}catch(a){console.log(a),B({text:a.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(n,a)=>{const U=ae("VDataTableServer"),x=ae("VueFileAgent");return te(),Ue(G,null,[t(ea,null,{default:s(()=>[t(aa,null,{default:s(()=>[t(le,{cols:"12"},{default:s(()=>[na]),_:1}),t(Te),t(le,{cols:"12"},{default:s(()=>[t(E,{color:"green-darken-3",onClick:S},{default:s(()=>[$("新增")]),_:1}),t(U,{"items-per-page":k.value,"onUpdate:itemsPerPage":[a[1]||(a[1]=l=>k.value=l),w],"sort-by":C.value,"onUpdate:sortBy":[a[2]||(a[2]=l=>C.value=l),w],page:v.value,"onUpdate:page":[a[3]||(a[3]=l=>v.value=l),w],items:d.value,headers:P,loading:M.value,"items-length":D.value,search:F.value,hover:""},{top:s(()=>[t(X,{label:"搜尋","append-icon":"mdi-magnify","onClick:append":_,onKeydown:De(_,["enter"]),modelValue:F.value,"onUpdate:modelValue":a[0]||(a[0]=l=>F.value=l)},null,8,["onKeydown","modelValue"])]),"item.image":s(({item:l})=>[t(_e,{src:l.raw.image,height:"80px"},null,8,["src"])]),"item.sell":s(({item:l})=>[l.raw.sell?(te(),Ne(Qe,{key:0,icon:"mdi-check"})):He("",!0)]),"item.edit":s(({item:l})=>[t(E,{icon:"mdi-pencil",onClick:L=>N(l.raw),variant:"text"},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(Ae,{persistent:"",width:"500px","scroll-strategy":"block",modelValue:V.value,"onUpdate:modelValue":a[11]||(a[11]=l=>V.value=l)},{default:s(()=>[t(Ze,{disabled:r(R),onSubmit:ze(r(p),["prevent"])},{default:s(()=>[t(Ee,null,{default:s(()=>[t($e,null,{default:s(()=>[$(Ge(y.value.length>0?"編輯商品":"新增商品"),1)]),_:1}),t(Ke,null,{default:s(()=>[t(X,{label:"名稱",modelValue:r(f).value.value,"onUpdate:modelValue":a[4]||(a[4]=l=>r(f).value.value=l),"error-messages":r(f).errorMessage.value},null,8,["modelValue","error-messages"]),t(X,{label:"價格",modelValue:r(b).value.value,"onUpdate:modelValue":a[5]||(a[5]=l=>r(b).value.value=l),modelModifiers:{number:!0},"error-messages":r(b).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(oa,{label:"說明",modelValue:r(h).value.value,"onUpdate:modelValue":a[6]||(a[6]=l=>r(h).value.value=l),"error-messages":r(h).errorMessage.value},null,8,["modelValue","error-messages"]),t(Oe,{label:"分類",modelValue:r(g).value.value,"onUpdate:modelValue":a[7]||(a[7]=l=>r(g).value.value=l),"error-messages":r(g).errorMessage.value,items:I},null,8,["modelValue","error-messages"]),t(ta,{label:"上架",modelValue:r(m).value.value,"onUpdate:modelValue":a[8]||(a[8]=l=>r(m).value.value=l),"error-messages":r(m).errorMessage.value},null,8,["modelValue","error-messages"]),t(x,{modelValue:o.value,"onUpdate:modelValue":a[9]||(a[9]=l=>o.value=l),"raw-model-value":c.value,"onUpdate:rawModelValue":a[10]||(a[10]=l=>c.value=l),"max-files":1,"max-size":"1MB",accept:"image/jpg,image/jpeg,image/png",multiple:!1,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖放到這裡",deletable:"",ref_key:"fileAgent",ref:i},null,8,["modelValue","raw-model-value"])]),_:1}),t(qe,null,{default:s(()=>[t(Le),t(E,{color:"red",onClick:H,loading:r(R)},{default:s(()=>[$("取消")]),_:1},8,["loading"]),t(E,{color:"green",type:"submit",loading:r(R)},{default:s(()=>[$("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{ca as default};
